<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="NetApp Active IQ : Workflow creation"><meta name=author content=brunseba><link href=https://brunseba.github.io/lab-netapp-activeiq/temporal-integration/ rel=canonical><link href=../DEVELOPMENT/ rel=prev><link href=../DEVELOPMENT/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>üîÑ Workflow Integration - Lab NetApp ActiveIQ</title><link rel=stylesheet href=../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#temporalio-integration-for-netapp-activeiq-api class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Lab NetApp ActiveIQ" class="md-header__button md-logo" aria-label="Lab NetApp ActiveIQ" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lab NetApp ActiveIQ </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> üîÑ Workflow Integration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=orange aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/brunseba/lab-netapp-activeiq title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> brunseba/lab-netapp-activeiq </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> üè† Home </a> </li> <li class=md-tabs__item> <a href=../getting-started/overview/ class=md-tabs__link> üöÄ Getting Started </a> </li> <li class=md-tabs__item> <a href=../netapp-activeiq-api-overview/ class=md-tabs__link> üîå NetApp ActiveIQ API </a> </li> <li class=md-tabs__item> <a href=../use-cases/netapp_api_use_cases_overview/ class=md-tabs__link> üìö Use Cases </a> </li> <li class=md-tabs__item> <a href=../examples/ class=md-tabs__link> üíª Implementation Examples </a> </li> <li class=md-tabs__item> <a href=../architecture/target-operating-model/ class=md-tabs__link> üèõÔ∏è Architecture & Design </a> </li> <li class=md-tabs__item> <a href=../getting-started/installation/ class=md-tabs__link> üöÄ Deployment Guides </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> ‚è±Ô∏è Temporal Workflows </a> </li> <li class=md-tabs__item> <a href=../api-management/api-management-strategy/ class=md-tabs__link> üåê API Management (APIM) </a> </li> <li class=md-tabs__item> <a href=../advanced-use-cases/ class=md-tabs__link> ü§ñ Day-2 AI Operations </a> </li> <li class=md-tabs__item> <a href=../testing/mermaid-test-page/ class=md-tabs__link> üß™ Testing & Development </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Lab NetApp ActiveIQ" class="md-nav__button md-logo" aria-label="Lab NetApp ActiveIQ" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg> </a> Lab NetApp ActiveIQ </label> <div class=md-nav__source> <a href=https://github.com/brunseba/lab-netapp-activeiq title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> brunseba/lab-netapp-activeiq </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=.. class=md-nav__link> <span class=md-ellipsis> üè† Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../getting-started/overview/ class=md-nav__link> <span class=md-ellipsis> üöÄ Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../netapp-activeiq-api-overview/ class=md-nav__link> <span class=md-ellipsis> üîå NetApp ActiveIQ API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../use-cases/netapp_api_use_cases_overview/ class=md-nav__link> <span class=md-ellipsis> üìö Use Cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../examples/ class=md-nav__link> <span class=md-ellipsis> üíª Implementation Examples </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../architecture/target-operating-model/ class=md-nav__link> <span class=md-ellipsis> üèõÔ∏è Architecture & Design </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> üöÄ Deployment Guides </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8 checked> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> ‚è±Ô∏è Temporal Workflows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=true> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> ‚è±Ô∏è Temporal Workflows </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> üîÑ Workflow Integration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> üîÑ Workflow Integration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="On this page"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> On this page </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#why-temporalio-for-netapp-operations class=md-nav__link> <span class=md-ellipsis> Why Temporal.io for NetApp Operations? </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#quick-start-guide class=md-nav__link> <span class=md-ellipsis> Quick Start Guide </span> </a> <nav class=md-nav aria-label="Quick Start Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-install-temporal-server class=md-nav__link> <span class=md-ellipsis> Step 1: Install Temporal Server </span> </a> </li> <li class=md-nav__item> <a href=#step-2-install-dependencies class=md-nav__link> <span class=md-ellipsis> Step 2: Install Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#step-3-environment-setup class=md-nav__link> <span class=md-ellipsis> Step 3: Environment Setup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#workflow-implementations-based-on-sequence-diagrams class=md-nav__link> <span class=md-ellipsis> Workflow Implementations Based on Sequence Diagrams </span> </a> <nav class=md-nav aria-label="Workflow Implementations Based on Sequence Diagrams"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-svm-creation-workflow class=md-nav__link> <span class=md-ellipsis> 1. SVM Creation Workflow </span> </a> </li> <li class=md-nav__item> <a href=#2-nfs-share-creation-workflow class=md-nav__link> <span class=md-ellipsis> 2. NFS Share Creation Workflow </span> </a> </li> <li class=md-nav__item> <a href=#3-worker-implementation class=md-nav__link> <span class=md-ellipsis> 3. Worker Implementation </span> </a> </li> <li class=md-nav__item> <a href=#4-client-usage-examples class=md-nav__link> <span class=md-ellipsis> 4. Client Usage Examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#running-the-workflows class=md-nav__link> <span class=md-ellipsis> Running the Workflows </span> </a> <nav class=md-nav aria-label="Running the Workflows"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-start-temporal-server class=md-nav__link> <span class=md-ellipsis> 1. Start Temporal Server </span> </a> </li> <li class=md-nav__item> <a href=#2-start-the-worker class=md-nav__link> <span class=md-ellipsis> 2. Start the Worker </span> </a> </li> <li class=md-nav__item> <a href=#3-execute-workflows class=md-nav__link> <span class=md-ellipsis> 3. Execute Workflows </span> </a> </li> <li class=md-nav__item> <a href=#4-monitor-workflows class=md-nav__link> <span class=md-ellipsis> 4. Monitor Workflows </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-handling-and-best-practices class=md-nav__link> <span class=md-ellipsis> Error Handling and Best Practices </span> </a> <nav class=md-nav aria-label="Error Handling and Best Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#retry-policies class=md-nav__link> <span class=md-ellipsis> Retry Policies </span> </a> </li> <li class=md-nav__item> <a href=#logging-and-monitoring class=md-nav__link> <span class=md-ellipsis> Logging and Monitoring </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../DEVELOPMENT/ class=md-nav__link> <span class=md-ellipsis> ‚öôÔ∏è Development Setup </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../api-management/api-management-strategy/ class=md-nav__link> <span class=md-ellipsis> üåê API Management (APIM) </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../advanced-use-cases/ class=md-nav__link> <span class=md-ellipsis> ü§ñ Day-2 AI Operations </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../testing/mermaid-test-page/ class=md-nav__link> <span class=md-ellipsis> üß™ Testing & Development </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/brunseba/lab-netapp-activeiq/edit/main/docs/temporal-integration.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/brunseba/lab-netapp-activeiq/raw/main/docs/temporal-integration.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=temporalio-integration-for-netapp-activeiq-api>Temporal.io Integration for NetApp ActiveIQ API<a class=headerlink href=#temporalio-integration-for-netapp-activeiq-api title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>This document provides comprehensive guidance for integrating Temporal.io workflows with the NetApp ActiveIQ API, based on the sequence diagrams and use cases defined in our advanced documentation. Temporal.io provides durable execution, automatic retries, and state management for complex NetApp infrastructure workflows.</p> <h2 id=why-temporalio-for-netapp-operations>Why Temporal.io for NetApp Operations?<a class=headerlink href=#why-temporalio-for-netapp-operations title="Permanent link">&para;</a></h2> <ul> <li><strong>Durability</strong>: Workflows survive process restarts and failures</li> <li><strong>Reliability</strong>: Automatic retries and error handling</li> <li><strong>Observability</strong>: Built-in monitoring and debugging capabilities</li> <li><strong>Scalability</strong>: Handle thousands of concurrent operations</li> <li><strong>State Management</strong>: Automatic persistence of workflow state</li> </ul> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <ul> <li>Docker installed and running</li> <li>Python 3.10+ (recommended: Python 3.12)</li> <li>NetApp ActiveIQ Unified Manager access</li> <li>Valid API credentials</li> </ul> <h2 id=quick-start-guide>Quick Start Guide<a class=headerlink href=#quick-start-guide title="Permanent link">&para;</a></h2> <h3 id=step-1-install-temporal-server>Step 1: Install Temporal Server<a class=headerlink href=#step-1-install-temporal-server title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Pull and run Temporal Server with auto-setup</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>temporalio<span class=w> </span>-p<span class=w> </span><span class=m>7233</span>:7233<span class=w> </span>-p<span class=w> </span><span class=m>8080</span>:8080<span class=w> </span>temporalio/auto-setup
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># Verify installation</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>curl<span class=w> </span>http://localhost:8080
</span></code></pre></div> <h3 id=step-2-install-dependencies>Step 2: Install Dependencies<a class=headerlink href=#step-2-install-dependencies title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Create virtual environment</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>python3<span class=w> </span>-m<span class=w> </span>venv<span class=w> </span>venv
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nb>source</span><span class=w> </span>venv/bin/activate<span class=w>  </span><span class=c1># On Windows: venv\Scripts\activate</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Install required packages</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>pip<span class=w> </span>install<span class=w> </span>temporalio<span class=w> </span>requests<span class=w> </span>dataclasses-json
</span></code></pre></div> <h3 id=step-3-environment-setup>Step 3: Environment Setup<a class=headerlink href=#step-3-environment-setup title="Permanent link">&para;</a></h3> <p>Create a <code>.env</code> file for configuration:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># NetApp ActiveIQ Configuration</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nv>NETAPP_UM_HOST</span><span class=o>=</span>your-unified-manager.company.com
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nv>NETAPP_USERNAME</span><span class=o>=</span>admin
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nv>NETAPP_PASSWORD</span><span class=o>=</span>your-secure-password
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1># Temporal Configuration</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=nv>TEMPORAL_HOST</span><span class=o>=</span>localhost:7233
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nv>TEMPORAL_NAMESPACE</span><span class=o>=</span>default
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=nv>TASK_QUEUE</span><span class=o>=</span>netapp-activeiq
</span></code></pre></div> <h2 id=workflow-implementations-based-on-sequence-diagrams>Workflow Implementations Based on Sequence Diagrams<a class=headerlink href=#workflow-implementations-based-on-sequence-diagrams title="Permanent link">&para;</a></h2> <h3 id=1-svm-creation-workflow>1. SVM Creation Workflow<a class=headerlink href=#1-svm-creation-workflow title="Permanent link">&para;</a></h3> <p>Based on the SVM Creation Sequence Diagram, here's the complete implementation:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># netapp_workflows.py</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>timedelta</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=kn>from</span><span class=w> </span><span class=nn>dataclasses</span><span class=w> </span><span class=kn>import</span> <span class=n>dataclass</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=kn>from</span><span class=w> </span><span class=nn>requests.auth</span><span class=w> </span><span class=kn>import</span> <span class=n>HTTPBasicAuth</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=kn>from</span><span class=w> </span><span class=nn>temporalio</span><span class=w> </span><span class=kn>import</span> <span class=n>workflow</span><span class=p>,</span> <span class=n>activity</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=kn>from</span><span class=w> </span><span class=nn>temporalio.common</span><span class=w> </span><span class=kn>import</span> <span class=n>RetryPolicy</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=nd>@dataclass</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=k>class</span><span class=w> </span><span class=nc>SVMConfig</span><span class=p>:</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=n>cluster_key</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>    <span class=n>aggregate_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=n>root_volume</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;root&quot;</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=n>language</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;c.utf_8&quot;</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>    <span class=n>security_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unix&quot;</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>    <span class=n>protocols</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>    <span class=k>def</span><span class=w> </span><span class=nf>__post_init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>protocols</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>            <span class=bp>self</span><span class=o>.</span><span class=n>protocols</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;nfs&quot;</span><span class=p>]</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=nd>@dataclass</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=k>class</span><span class=w> </span><span class=nc>NetworkInterface</span><span class=p>:</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>    <span class=n>ip_address</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>    <span class=n>netmask</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>    <span class=n>node_uuid</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>    <span class=n>port_name</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>    <span class=n>service_policy</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a><span class=c1># Activities for NetApp API Operations</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>validate_cluster_health</span><span class=p>(</span><span class=n>cluster_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 1: Validate cluster health before SVM creation&quot;&quot;&quot;</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/datacenter/cluster/clusters/</span><span class=si>{</span><span class=n>cluster_key</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;fields&quot;</span><span class=p>:</span> <span class=s2>&quot;name,state,health,version&quot;</span><span class=p>}</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a>        <span class=n>url</span><span class=p>,</span>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a>        <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a>        <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span>
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a>        <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># For self-signed certificates</span>
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a>        <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span>
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a>    <span class=p>)</span>
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a>
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to validate cluster: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a>
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a>    <span class=n>cluster</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a>    <span class=k>if</span> <span class=n>cluster</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>)</span> <span class=o>!=</span> <span class=s1>&#39;up&#39;</span><span class=p>:</span>
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Cluster </span><span class=si>{</span><span class=n>cluster</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> is not up: </span><span class=si>{</span><span class=n>cluster</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a>
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58 href=#__codelineno-3-58></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;‚úì Cluster </span><span class=si>{</span><span class=n>cluster</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> is healthy and ready&quot;</span><span class=p>)</span>
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59 href=#__codelineno-3-59></a>    <span class=k>return</span> <span class=n>cluster</span>
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60 href=#__codelineno-3-60></a>
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61 href=#__codelineno-3-61></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62 href=#__codelineno-3-62></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_available_aggregates</span><span class=p>(</span><span class=n>cluster_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63 href=#__codelineno-3-63></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 2: Get available aggregates for SVM creation&quot;&quot;&quot;</span>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64 href=#__codelineno-3-64></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/datacenter/storage/aggregates&quot;</span>
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65 href=#__codelineno-3-65></a>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66 href=#__codelineno-3-66></a>        <span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;cluster.key:</span><span class=si>{</span><span class=n>cluster_key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67 href=#__codelineno-3-67></a>        <span class=s2>&quot;fields&quot;</span><span class=p>:</span> <span class=s2>&quot;name,key,space.size,space.available,state&quot;</span>
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68 href=#__codelineno-3-68></a>    <span class=p>}</span>
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69 href=#__codelineno-3-69></a>
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70 href=#__codelineno-3-70></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71 href=#__codelineno-3-71></a>
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72 href=#__codelineno-3-72></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73 href=#__codelineno-3-73></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to get aggregates: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74 href=#__codelineno-3-74></a>
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75 href=#__codelineno-3-75></a>    <span class=n>aggregates</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;records&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76 href=#__codelineno-3-76></a>    <span class=n>available_aggs</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77 href=#__codelineno-3-77></a>        <span class=n>agg</span> <span class=k>for</span> <span class=n>agg</span> <span class=ow>in</span> <span class=n>aggregates</span>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78 href=#__codelineno-3-78></a>        <span class=k>if</span> <span class=n>agg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;online&#39;</span> <span class=ow>and</span> <span class=n>agg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;space&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;available&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10737418240</span>  <span class=c1># 10GB min</span>
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79 href=#__codelineno-3-79></a>    <span class=p>]</span>
</span><span id=__span-3-80><a id=__codelineno-3-80 name=__codelineno-3-80 href=#__codelineno-3-80></a>
</span><span id=__span-3-81><a id=__codelineno-3-81 name=__codelineno-3-81 href=#__codelineno-3-81></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>available_aggs</span><span class=p>)</span><span class=si>}</span><span class=s2> available aggregates&quot;</span><span class=p>)</span>
</span><span id=__span-3-82><a id=__codelineno-3-82 name=__codelineno-3-82 href=#__codelineno-3-82></a>    <span class=k>return</span> <span class=n>available_aggs</span>
</span><span id=__span-3-83><a id=__codelineno-3-83 name=__codelineno-3-83 href=#__codelineno-3-83></a>
</span><span id=__span-3-84><a id=__codelineno-3-84 name=__codelineno-3-84 href=#__codelineno-3-84></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-3-85><a id=__codelineno-3-85 name=__codelineno-3-85 href=#__codelineno-3-85></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_svm</span><span class=p>(</span><span class=n>svm_config</span><span class=p>:</span> <span class=n>SVMConfig</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-3-86><a id=__codelineno-3-86 name=__codelineno-3-86 href=#__codelineno-3-86></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 3: Create SVM with specified configuration&quot;&quot;&quot;</span>
</span><span id=__span-3-87><a id=__codelineno-3-87 name=__codelineno-3-87 href=#__codelineno-3-87></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/datacenter/svm/svms&quot;</span>
</span><span id=__span-3-88><a id=__codelineno-3-88 name=__codelineno-3-88 href=#__codelineno-3-88></a>
</span><span id=__span-3-89><a id=__codelineno-3-89 name=__codelineno-3-89 href=#__codelineno-3-89></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-3-90><a id=__codelineno-3-90 name=__codelineno-3-90 href=#__codelineno-3-90></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-3-91><a id=__codelineno-3-91 name=__codelineno-3-91 href=#__codelineno-3-91></a>        <span class=s2>&quot;cluster&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>cluster_key</span><span class=p>},</span>
</span><span id=__span-3-92><a id=__codelineno-3-92 name=__codelineno-3-92 href=#__codelineno-3-92></a>        <span class=s2>&quot;state&quot;</span><span class=p>:</span> <span class=s2>&quot;running&quot;</span><span class=p>,</span>
</span><span id=__span-3-93><a id=__codelineno-3-93 name=__codelineno-3-93 href=#__codelineno-3-93></a>        <span class=s2>&quot;subtype&quot;</span><span class=p>:</span> <span class=s2>&quot;default&quot;</span><span class=p>,</span>
</span><span id=__span-3-94><a id=__codelineno-3-94 name=__codelineno-3-94 href=#__codelineno-3-94></a>        <span class=s2>&quot;language&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>language</span><span class=p>,</span>
</span><span id=__span-3-95><a id=__codelineno-3-95 name=__codelineno-3-95 href=#__codelineno-3-95></a>        <span class=s2>&quot;security_style&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>security_style</span><span class=p>,</span>
</span><span id=__span-3-96><a id=__codelineno-3-96 name=__codelineno-3-96 href=#__codelineno-3-96></a>        <span class=s2>&quot;allowed_protocols&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>protocols</span>
</span><span id=__span-3-97><a id=__codelineno-3-97 name=__codelineno-3-97 href=#__codelineno-3-97></a>    <span class=p>}</span>
</span><span id=__span-3-98><a id=__codelineno-3-98 name=__codelineno-3-98 href=#__codelineno-3-98></a>
</span><span id=__span-3-99><a id=__codelineno-3-99 name=__codelineno-3-99 href=#__codelineno-3-99></a>    <span class=k>if</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>aggregate_name</span><span class=p>:</span>
</span><span id=__span-3-100><a id=__codelineno-3-100 name=__codelineno-3-100 href=#__codelineno-3-100></a>        <span class=n>payload</span><span class=p>[</span><span class=s2>&quot;aggregates&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>aggregate_name</span><span class=p>}]</span>
</span><span id=__span-3-101><a id=__codelineno-3-101 name=__codelineno-3-101 href=#__codelineno-3-101></a>
</span><span id=__span-3-102><a id=__codelineno-3-102 name=__codelineno-3-102 href=#__codelineno-3-102></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-3-103><a id=__codelineno-3-103 name=__codelineno-3-103 href=#__codelineno-3-103></a>        <span class=n>url</span><span class=p>,</span>
</span><span id=__span-3-104><a id=__codelineno-3-104 name=__codelineno-3-104 href=#__codelineno-3-104></a>        <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span>
</span><span id=__span-3-105><a id=__codelineno-3-105 name=__codelineno-3-105 href=#__codelineno-3-105></a>        <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span>
</span><span id=__span-3-106><a id=__codelineno-3-106 name=__codelineno-3-106 href=#__codelineno-3-106></a>        <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-3-107><a id=__codelineno-3-107 name=__codelineno-3-107 href=#__codelineno-3-107></a>        <span class=n>timeout</span><span class=o>=</span><span class=mi>60</span>
</span><span id=__span-3-108><a id=__codelineno-3-108 name=__codelineno-3-108 href=#__codelineno-3-108></a>    <span class=p>)</span>
</span><span id=__span-3-109><a id=__codelineno-3-109 name=__codelineno-3-109 href=#__codelineno-3-109></a>
</span><span id=__span-3-110><a id=__codelineno-3-110 name=__codelineno-3-110 href=#__codelineno-3-110></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>201</span><span class=p>,</span> <span class=mi>202</span><span class=p>]:</span>
</span><span id=__span-3-111><a id=__codelineno-3-111 name=__codelineno-3-111 href=#__codelineno-3-111></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to create SVM: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-112><a id=__codelineno-3-112 name=__codelineno-3-112 href=#__codelineno-3-112></a>
</span><span id=__span-3-113><a id=__codelineno-3-113 name=__codelineno-3-113 href=#__codelineno-3-113></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-3-114><a id=__codelineno-3-114 name=__codelineno-3-114 href=#__codelineno-3-114></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;‚úì SVM creation initiated: </span><span class=si>{</span><span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-115><a id=__codelineno-3-115 name=__codelineno-3-115 href=#__codelineno-3-115></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-3-116><a id=__codelineno-3-116 name=__codelineno-3-116 href=#__codelineno-3-116></a>
</span><span id=__span-3-117><a id=__codelineno-3-117 name=__codelineno-3-117 href=#__codelineno-3-117></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-3-118><a id=__codelineno-3-118 name=__codelineno-3-118 href=#__codelineno-3-118></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>monitor_job_completion</span><span class=p>(</span><span class=n>job_uuid</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>,</span> <span class=n>timeout_minutes</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-3-119><a id=__codelineno-3-119 name=__codelineno-3-119 href=#__codelineno-3-119></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 4: Monitor job completion with polling&quot;&quot;&quot;</span>
</span><span id=__span-3-120><a id=__codelineno-3-120 name=__codelineno-3-120 href=#__codelineno-3-120></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/management-server/jobs/</span><span class=si>{</span><span class=n>job_uuid</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-3-121><a id=__codelineno-3-121 name=__codelineno-3-121 href=#__codelineno-3-121></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-3-122><a id=__codelineno-3-122 name=__codelineno-3-122 href=#__codelineno-3-122></a>    <span class=n>max_wait</span> <span class=o>=</span> <span class=n>timeout_minutes</span> <span class=o>*</span> <span class=mi>60</span>
</span><span id=__span-3-123><a id=__codelineno-3-123 name=__codelineno-3-123 href=#__codelineno-3-123></a>
</span><span id=__span-3-124><a id=__codelineno-3-124 name=__codelineno-3-124 href=#__codelineno-3-124></a>    <span class=k>while</span> <span class=p>(</span><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>max_wait</span><span class=p>:</span>
</span><span id=__span-3-125><a id=__codelineno-3-125 name=__codelineno-3-125 href=#__codelineno-3-125></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-3-126><a id=__codelineno-3-126 name=__codelineno-3-126 href=#__codelineno-3-126></a>
</span><span id=__span-3-127><a id=__codelineno-3-127 name=__codelineno-3-127 href=#__codelineno-3-127></a>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-3-128><a id=__codelineno-3-128 name=__codelineno-3-128 href=#__codelineno-3-128></a>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to check job status: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-129><a id=__codelineno-3-129 name=__codelineno-3-129 href=#__codelineno-3-129></a>
</span><span id=__span-3-130><a id=__codelineno-3-130 name=__codelineno-3-130 href=#__codelineno-3-130></a>        <span class=n>job</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-3-131><a id=__codelineno-3-131 name=__codelineno-3-131 href=#__codelineno-3-131></a>        <span class=n>state</span> <span class=o>=</span> <span class=n>job</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>)</span>
</span><span id=__span-3-132><a id=__codelineno-3-132 name=__codelineno-3-132 href=#__codelineno-3-132></a>
</span><span id=__span-3-133><a id=__codelineno-3-133 name=__codelineno-3-133 href=#__codelineno-3-133></a>        <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Job </span><span class=si>{</span><span class=n>job_uuid</span><span class=si>}</span><span class=s2> status: </span><span class=si>{</span><span class=n>state</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>job</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;progress&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=si>}</span><span class=s2>%)&quot;</span><span class=p>)</span>
</span><span id=__span-3-134><a id=__codelineno-3-134 name=__codelineno-3-134 href=#__codelineno-3-134></a>
</span><span id=__span-3-135><a id=__codelineno-3-135 name=__codelineno-3-135 href=#__codelineno-3-135></a>        <span class=k>if</span> <span class=n>state</span> <span class=o>==</span> <span class=s1>&#39;success&#39;</span><span class=p>:</span>
</span><span id=__span-3-136><a id=__codelineno-3-136 name=__codelineno-3-136 href=#__codelineno-3-136></a>            <span class=k>return</span> <span class=n>job</span>
</span><span id=__span-3-137><a id=__codelineno-3-137 name=__codelineno-3-137 href=#__codelineno-3-137></a>        <span class=k>elif</span> <span class=n>state</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;failure&#39;</span><span class=p>,</span> <span class=s1>&#39;partial_failures&#39;</span><span class=p>]:</span>
</span><span id=__span-3-138><a id=__codelineno-3-138 name=__codelineno-3-138 href=#__codelineno-3-138></a>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Job failed: </span><span class=si>{</span><span class=n>job</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unknown error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-139><a id=__codelineno-3-139 name=__codelineno-3-139 href=#__codelineno-3-139></a>
</span><span id=__span-3-140><a id=__codelineno-3-140 name=__codelineno-3-140 href=#__codelineno-3-140></a>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>  <span class=c1># Poll every 10 seconds</span>
</span><span id=__span-3-141><a id=__codelineno-3-141 name=__codelineno-3-141 href=#__codelineno-3-141></a>
</span><span id=__span-3-142><a id=__codelineno-3-142 name=__codelineno-3-142 href=#__codelineno-3-142></a>    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Job </span><span class=si>{</span><span class=n>job_uuid</span><span class=si>}</span><span class=s2> timed out after </span><span class=si>{</span><span class=n>timeout_minutes</span><span class=si>}</span><span class=s2> minutes&quot;</span><span class=p>)</span>
</span><span id=__span-3-143><a id=__codelineno-3-143 name=__codelineno-3-143 href=#__codelineno-3-143></a>
</span><span id=__span-3-144><a id=__codelineno-3-144 name=__codelineno-3-144 href=#__codelineno-3-144></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-3-145><a id=__codelineno-3-145 name=__codelineno-3-145 href=#__codelineno-3-145></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_network_interface</span><span class=p>(</span><span class=n>svm_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>interface</span><span class=p>:</span> <span class=n>NetworkInterface</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-3-146><a id=__codelineno-3-146 name=__codelineno-3-146 href=#__codelineno-3-146></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 5 &amp; 6: Create management and data network interfaces&quot;&quot;&quot;</span>
</span><span id=__span-3-147><a id=__codelineno-3-147 name=__codelineno-3-147 href=#__codelineno-3-147></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/datacenter/svm/svms/</span><span class=si>{</span><span class=n>svm_key</span><span class=si>}</span><span class=s2>/network/ip/interfaces&quot;</span>
</span><span id=__span-3-148><a id=__codelineno-3-148 name=__codelineno-3-148 href=#__codelineno-3-148></a>
</span><span id=__span-3-149><a id=__codelineno-3-149 name=__codelineno-3-149 href=#__codelineno-3-149></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-3-150><a id=__codelineno-3-150 name=__codelineno-3-150 href=#__codelineno-3-150></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-3-151><a id=__codelineno-3-151 name=__codelineno-3-151 href=#__codelineno-3-151></a>        <span class=s2>&quot;ip&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-152><a id=__codelineno-3-152 name=__codelineno-3-152 href=#__codelineno-3-152></a>            <span class=s2>&quot;address&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=o>.</span><span class=n>ip_address</span><span class=p>,</span>
</span><span id=__span-3-153><a id=__codelineno-3-153 name=__codelineno-3-153 href=#__codelineno-3-153></a>            <span class=s2>&quot;netmask&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=o>.</span><span class=n>netmask</span>
</span><span id=__span-3-154><a id=__codelineno-3-154 name=__codelineno-3-154 href=#__codelineno-3-154></a>        <span class=p>},</span>
</span><span id=__span-3-155><a id=__codelineno-3-155 name=__codelineno-3-155 href=#__codelineno-3-155></a>        <span class=s2>&quot;location&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-156><a id=__codelineno-3-156 name=__codelineno-3-156 href=#__codelineno-3-156></a>            <span class=s2>&quot;home_node&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;uuid&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=o>.</span><span class=n>node_uuid</span><span class=p>},</span>
</span><span id=__span-3-157><a id=__codelineno-3-157 name=__codelineno-3-157 href=#__codelineno-3-157></a>            <span class=s2>&quot;home_port&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=o>.</span><span class=n>port_name</span><span class=p>}</span>
</span><span id=__span-3-158><a id=__codelineno-3-158 name=__codelineno-3-158 href=#__codelineno-3-158></a>        <span class=p>},</span>
</span><span id=__span-3-159><a id=__codelineno-3-159 name=__codelineno-3-159 href=#__codelineno-3-159></a>        <span class=s2>&quot;service_policy&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=o>.</span><span class=n>service_policy</span><span class=p>,</span>
</span><span id=__span-3-160><a id=__codelineno-3-160 name=__codelineno-3-160 href=#__codelineno-3-160></a>        <span class=s2>&quot;enabled&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-3-161><a id=__codelineno-3-161 name=__codelineno-3-161 href=#__codelineno-3-161></a>    <span class=p>}</span>
</span><span id=__span-3-162><a id=__codelineno-3-162 name=__codelineno-3-162 href=#__codelineno-3-162></a>
</span><span id=__span-3-163><a id=__codelineno-3-163 name=__codelineno-3-163 href=#__codelineno-3-163></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-3-164><a id=__codelineno-3-164 name=__codelineno-3-164 href=#__codelineno-3-164></a>        <span class=n>url</span><span class=p>,</span>
</span><span id=__span-3-165><a id=__codelineno-3-165 name=__codelineno-3-165 href=#__codelineno-3-165></a>        <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span>
</span><span id=__span-3-166><a id=__codelineno-3-166 name=__codelineno-3-166 href=#__codelineno-3-166></a>        <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span>
</span><span id=__span-3-167><a id=__codelineno-3-167 name=__codelineno-3-167 href=#__codelineno-3-167></a>        <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-3-168><a id=__codelineno-3-168 name=__codelineno-3-168 href=#__codelineno-3-168></a>        <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span>
</span><span id=__span-3-169><a id=__codelineno-3-169 name=__codelineno-3-169 href=#__codelineno-3-169></a>    <span class=p>)</span>
</span><span id=__span-3-170><a id=__codelineno-3-170 name=__codelineno-3-170 href=#__codelineno-3-170></a>
</span><span id=__span-3-171><a id=__codelineno-3-171 name=__codelineno-3-171 href=#__codelineno-3-171></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>201</span><span class=p>,</span> <span class=mi>202</span><span class=p>]:</span>
</span><span id=__span-3-172><a id=__codelineno-3-172 name=__codelineno-3-172 href=#__codelineno-3-172></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to create interface </span><span class=si>{</span><span class=n>interface</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-173><a id=__codelineno-3-173 name=__codelineno-3-173 href=#__codelineno-3-173></a>
</span><span id=__span-3-174><a id=__codelineno-3-174 name=__codelineno-3-174 href=#__codelineno-3-174></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;‚úì Network interface </span><span class=si>{</span><span class=n>interface</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> created&quot;</span><span class=p>)</span>
</span><span id=__span-3-175><a id=__codelineno-3-175 name=__codelineno-3-175 href=#__codelineno-3-175></a>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-3-176><a id=__codelineno-3-176 name=__codelineno-3-176 href=#__codelineno-3-176></a>
</span><span id=__span-3-177><a id=__codelineno-3-177 name=__codelineno-3-177 href=#__codelineno-3-177></a><span class=c1># SVM Creation Workflow</span>
</span><span id=__span-3-178><a id=__codelineno-3-178 name=__codelineno-3-178 href=#__codelineno-3-178></a><span class=nd>@workflow</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-3-179><a id=__codelineno-3-179 name=__codelineno-3-179 href=#__codelineno-3-179></a><span class=k>class</span><span class=w> </span><span class=nc>SVMCreationWorkflow</span><span class=p>:</span>
</span><span id=__span-3-180><a id=__codelineno-3-180 name=__codelineno-3-180 href=#__codelineno-3-180></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Complete SVM Creation Workflow based on sequence diagram&quot;&quot;&quot;</span>
</span><span id=__span-3-181><a id=__codelineno-3-181 name=__codelineno-3-181 href=#__codelineno-3-181></a>
</span><span id=__span-3-182><a id=__codelineno-3-182 name=__codelineno-3-182 href=#__codelineno-3-182></a>    <span class=nd>@workflow</span><span class=o>.</span><span class=n>run</span>
</span><span id=__span-3-183><a id=__codelineno-3-183 name=__codelineno-3-183 href=#__codelineno-3-183></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>svm_config</span><span class=p>:</span> <span class=n>SVMConfig</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-3-184><a id=__codelineno-3-184 name=__codelineno-3-184 href=#__codelineno-3-184></a>        <span class=n>retry_policy</span> <span class=o>=</span> <span class=n>RetryPolicy</span><span class=p>(</span>
</span><span id=__span-3-185><a id=__codelineno-3-185 name=__codelineno-3-185 href=#__codelineno-3-185></a>            <span class=n>initial_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-3-186><a id=__codelineno-3-186 name=__codelineno-3-186 href=#__codelineno-3-186></a>            <span class=n>maximum_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>60</span><span class=p>),</span>
</span><span id=__span-3-187><a id=__codelineno-3-187 name=__codelineno-3-187 href=#__codelineno-3-187></a>            <span class=n>maximum_attempts</span><span class=o>=</span><span class=mi>3</span>
</span><span id=__span-3-188><a id=__codelineno-3-188 name=__codelineno-3-188 href=#__codelineno-3-188></a>        <span class=p>)</span>
</span><span id=__span-3-189><a id=__codelineno-3-189 name=__codelineno-3-189 href=#__codelineno-3-189></a>
</span><span id=__span-3-190><a id=__codelineno-3-190 name=__codelineno-3-190 href=#__codelineno-3-190></a>        <span class=n>workflow</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Starting SVM creation workflow for </span><span class=si>{</span><span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-191><a id=__codelineno-3-191 name=__codelineno-3-191 href=#__codelineno-3-191></a>
</span><span id=__span-3-192><a id=__codelineno-3-192 name=__codelineno-3-192 href=#__codelineno-3-192></a>        <span class=c1># Step 1: Validate cluster health</span>
</span><span id=__span-3-193><a id=__codelineno-3-193 name=__codelineno-3-193 href=#__codelineno-3-193></a>        <span class=n>cluster_info</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-3-194><a id=__codelineno-3-194 name=__codelineno-3-194 href=#__codelineno-3-194></a>            <span class=n>validate_cluster_health</span><span class=p>,</span>
</span><span id=__span-3-195><a id=__codelineno-3-195 name=__codelineno-3-195 href=#__codelineno-3-195></a>            <span class=n>svm_config</span><span class=o>.</span><span class=n>cluster_key</span><span class=p>,</span>
</span><span id=__span-3-196><a id=__codelineno-3-196 name=__codelineno-3-196 href=#__codelineno-3-196></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-3-197><a id=__codelineno-3-197 name=__codelineno-3-197 href=#__codelineno-3-197></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-3-198><a id=__codelineno-3-198 name=__codelineno-3-198 href=#__codelineno-3-198></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-3-199><a id=__codelineno-3-199 name=__codelineno-3-199 href=#__codelineno-3-199></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-3-200><a id=__codelineno-3-200 name=__codelineno-3-200 href=#__codelineno-3-200></a>        <span class=p>)</span>
</span><span id=__span-3-201><a id=__codelineno-3-201 name=__codelineno-3-201 href=#__codelineno-3-201></a>
</span><span id=__span-3-202><a id=__codelineno-3-202 name=__codelineno-3-202 href=#__codelineno-3-202></a>        <span class=c1># Step 2: Get available aggregates</span>
</span><span id=__span-3-203><a id=__codelineno-3-203 name=__codelineno-3-203 href=#__codelineno-3-203></a>        <span class=n>aggregates</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-3-204><a id=__codelineno-3-204 name=__codelineno-3-204 href=#__codelineno-3-204></a>            <span class=n>get_available_aggregates</span><span class=p>,</span>
</span><span id=__span-3-205><a id=__codelineno-3-205 name=__codelineno-3-205 href=#__codelineno-3-205></a>            <span class=n>svm_config</span><span class=o>.</span><span class=n>cluster_key</span><span class=p>,</span>
</span><span id=__span-3-206><a id=__codelineno-3-206 name=__codelineno-3-206 href=#__codelineno-3-206></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-3-207><a id=__codelineno-3-207 name=__codelineno-3-207 href=#__codelineno-3-207></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-3-208><a id=__codelineno-3-208 name=__codelineno-3-208 href=#__codelineno-3-208></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-3-209><a id=__codelineno-3-209 name=__codelineno-3-209 href=#__codelineno-3-209></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-3-210><a id=__codelineno-3-210 name=__codelineno-3-210 href=#__codelineno-3-210></a>        <span class=p>)</span>
</span><span id=__span-3-211><a id=__codelineno-3-211 name=__codelineno-3-211 href=#__codelineno-3-211></a>
</span><span id=__span-3-212><a id=__codelineno-3-212 name=__codelineno-3-212 href=#__codelineno-3-212></a>        <span class=c1># Select best aggregate (most available space)</span>
</span><span id=__span-3-213><a id=__codelineno-3-213 name=__codelineno-3-213 href=#__codelineno-3-213></a>        <span class=k>if</span> <span class=n>aggregates</span><span class=p>:</span>
</span><span id=__span-3-214><a id=__codelineno-3-214 name=__codelineno-3-214 href=#__codelineno-3-214></a>            <span class=n>best_aggregate</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>aggregates</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;space&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;available&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span><span id=__span-3-215><a id=__codelineno-3-215 name=__codelineno-3-215 href=#__codelineno-3-215></a>            <span class=n>svm_config</span><span class=o>.</span><span class=n>aggregate_name</span> <span class=o>=</span> <span class=n>best_aggregate</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span><span id=__span-3-216><a id=__codelineno-3-216 name=__codelineno-3-216 href=#__codelineno-3-216></a>            <span class=n>workflow</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Selected aggregate: </span><span class=si>{</span><span class=n>best_aggregate</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-217><a id=__codelineno-3-217 name=__codelineno-3-217 href=#__codelineno-3-217></a>
</span><span id=__span-3-218><a id=__codelineno-3-218 name=__codelineno-3-218 href=#__codelineno-3-218></a>        <span class=c1># Step 3: Create SVM</span>
</span><span id=__span-3-219><a id=__codelineno-3-219 name=__codelineno-3-219 href=#__codelineno-3-219></a>        <span class=n>svm_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-3-220><a id=__codelineno-3-220 name=__codelineno-3-220 href=#__codelineno-3-220></a>            <span class=n>create_svm</span><span class=p>,</span>
</span><span id=__span-3-221><a id=__codelineno-3-221 name=__codelineno-3-221 href=#__codelineno-3-221></a>            <span class=n>svm_config</span><span class=p>,</span>
</span><span id=__span-3-222><a id=__codelineno-3-222 name=__codelineno-3-222 href=#__codelineno-3-222></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-3-223><a id=__codelineno-3-223 name=__codelineno-3-223 href=#__codelineno-3-223></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-3-224><a id=__codelineno-3-224 name=__codelineno-3-224 href=#__codelineno-3-224></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-3-225><a id=__codelineno-3-225 name=__codelineno-3-225 href=#__codelineno-3-225></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-3-226><a id=__codelineno-3-226 name=__codelineno-3-226 href=#__codelineno-3-226></a>        <span class=p>)</span>
</span><span id=__span-3-227><a id=__codelineno-3-227 name=__codelineno-3-227 href=#__codelineno-3-227></a>
</span><span id=__span-3-228><a id=__codelineno-3-228 name=__codelineno-3-228 href=#__codelineno-3-228></a>        <span class=c1># Step 4: Monitor job completion if async operation</span>
</span><span id=__span-3-229><a id=__codelineno-3-229 name=__codelineno-3-229 href=#__codelineno-3-229></a>        <span class=k>if</span> <span class=s1>&#39;job&#39;</span> <span class=ow>in</span> <span class=n>svm_result</span><span class=p>:</span>
</span><span id=__span-3-230><a id=__codelineno-3-230 name=__codelineno-3-230 href=#__codelineno-3-230></a>            <span class=n>job_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-3-231><a id=__codelineno-3-231 name=__codelineno-3-231 href=#__codelineno-3-231></a>                <span class=n>monitor_job_completion</span><span class=p>,</span>
</span><span id=__span-3-232><a id=__codelineno-3-232 name=__codelineno-3-232 href=#__codelineno-3-232></a>                <span class=n>svm_result</span><span class=p>[</span><span class=s1>&#39;job&#39;</span><span class=p>][</span><span class=s1>&#39;uuid&#39;</span><span class=p>],</span>
</span><span id=__span-3-233><a id=__codelineno-3-233 name=__codelineno-3-233 href=#__codelineno-3-233></a>                <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-3-234><a id=__codelineno-3-234 name=__codelineno-3-234 href=#__codelineno-3-234></a>                <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-3-235><a id=__codelineno-3-235 name=__codelineno-3-235 href=#__codelineno-3-235></a>                <span class=mi>30</span><span class=p>,</span>  <span class=c1># timeout in minutes</span>
</span><span id=__span-3-236><a id=__codelineno-3-236 name=__codelineno-3-236 href=#__codelineno-3-236></a>                <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>35</span><span class=p>),</span>
</span><span id=__span-3-237><a id=__codelineno-3-237 name=__codelineno-3-237 href=#__codelineno-3-237></a>                <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-3-238><a id=__codelineno-3-238 name=__codelineno-3-238 href=#__codelineno-3-238></a>            <span class=p>)</span>
</span><span id=__span-3-239><a id=__codelineno-3-239 name=__codelineno-3-239 href=#__codelineno-3-239></a>
</span><span id=__span-3-240><a id=__codelineno-3-240 name=__codelineno-3-240 href=#__codelineno-3-240></a>        <span class=n>svm_key</span> <span class=o>=</span> <span class=n>svm_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;svm_key&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>svm_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span>
</span><span id=__span-3-241><a id=__codelineno-3-241 name=__codelineno-3-241 href=#__codelineno-3-241></a>
</span><span id=__span-3-242><a id=__codelineno-3-242 name=__codelineno-3-242 href=#__codelineno-3-242></a>        <span class=c1># Steps 5 &amp; 6: Create network interfaces</span>
</span><span id=__span-3-243><a id=__codelineno-3-243 name=__codelineno-3-243 href=#__codelineno-3-243></a>        <span class=n>mgmt_interface</span> <span class=o>=</span> <span class=n>NetworkInterface</span><span class=p>(</span>
</span><span id=__span-3-244><a id=__codelineno-3-244 name=__codelineno-3-244 href=#__codelineno-3-244></a>            <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>_mgmt&quot;</span><span class=p>,</span>
</span><span id=__span-3-245><a id=__codelineno-3-245 name=__codelineno-3-245 href=#__codelineno-3-245></a>            <span class=n>ip_address</span><span class=o>=</span><span class=s2>&quot;10.1.100.50&quot;</span><span class=p>,</span>  <span class=c1># This should be parameterized</span>
</span><span id=__span-3-246><a id=__codelineno-3-246 name=__codelineno-3-246 href=#__codelineno-3-246></a>            <span class=n>netmask</span><span class=o>=</span><span class=s2>&quot;255.255.255.0&quot;</span><span class=p>,</span>
</span><span id=__span-3-247><a id=__codelineno-3-247 name=__codelineno-3-247 href=#__codelineno-3-247></a>            <span class=n>node_uuid</span><span class=o>=</span><span class=s2>&quot;node-uuid-placeholder&quot;</span><span class=p>,</span>  <span class=c1># This should be retrieved dynamically</span>
</span><span id=__span-3-248><a id=__codelineno-3-248 name=__codelineno-3-248 href=#__codelineno-3-248></a>            <span class=n>port_name</span><span class=o>=</span><span class=s2>&quot;e0c&quot;</span><span class=p>,</span>
</span><span id=__span-3-249><a id=__codelineno-3-249 name=__codelineno-3-249 href=#__codelineno-3-249></a>            <span class=n>service_policy</span><span class=o>=</span><span class=s2>&quot;default-management&quot;</span>
</span><span id=__span-3-250><a id=__codelineno-3-250 name=__codelineno-3-250 href=#__codelineno-3-250></a>        <span class=p>)</span>
</span><span id=__span-3-251><a id=__codelineno-3-251 name=__codelineno-3-251 href=#__codelineno-3-251></a>
</span><span id=__span-3-252><a id=__codelineno-3-252 name=__codelineno-3-252 href=#__codelineno-3-252></a>        <span class=n>data_interface</span> <span class=o>=</span> <span class=n>NetworkInterface</span><span class=p>(</span>
</span><span id=__span-3-253><a id=__codelineno-3-253 name=__codelineno-3-253 href=#__codelineno-3-253></a>            <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>_data&quot;</span><span class=p>,</span>
</span><span id=__span-3-254><a id=__codelineno-3-254 name=__codelineno-3-254 href=#__codelineno-3-254></a>            <span class=n>ip_address</span><span class=o>=</span><span class=s2>&quot;10.1.100.51&quot;</span><span class=p>,</span>  <span class=c1># This should be parameterized</span>
</span><span id=__span-3-255><a id=__codelineno-3-255 name=__codelineno-3-255 href=#__codelineno-3-255></a>            <span class=n>netmask</span><span class=o>=</span><span class=s2>&quot;255.255.255.0&quot;</span><span class=p>,</span>
</span><span id=__span-3-256><a id=__codelineno-3-256 name=__codelineno-3-256 href=#__codelineno-3-256></a>            <span class=n>node_uuid</span><span class=o>=</span><span class=s2>&quot;node-uuid-placeholder&quot;</span><span class=p>,</span>  <span class=c1># This should be retrieved dynamically</span>
</span><span id=__span-3-257><a id=__codelineno-3-257 name=__codelineno-3-257 href=#__codelineno-3-257></a>            <span class=n>port_name</span><span class=o>=</span><span class=s2>&quot;e0d&quot;</span><span class=p>,</span>
</span><span id=__span-3-258><a id=__codelineno-3-258 name=__codelineno-3-258 href=#__codelineno-3-258></a>            <span class=n>service_policy</span><span class=o>=</span><span class=s2>&quot;default-data-files&quot;</span>
</span><span id=__span-3-259><a id=__codelineno-3-259 name=__codelineno-3-259 href=#__codelineno-3-259></a>        <span class=p>)</span>
</span><span id=__span-3-260><a id=__codelineno-3-260 name=__codelineno-3-260 href=#__codelineno-3-260></a>
</span><span id=__span-3-261><a id=__codelineno-3-261 name=__codelineno-3-261 href=#__codelineno-3-261></a>        <span class=c1># Create management interface</span>
</span><span id=__span-3-262><a id=__codelineno-3-262 name=__codelineno-3-262 href=#__codelineno-3-262></a>        <span class=n>mgmt_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-3-263><a id=__codelineno-3-263 name=__codelineno-3-263 href=#__codelineno-3-263></a>            <span class=n>create_network_interface</span><span class=p>,</span>
</span><span id=__span-3-264><a id=__codelineno-3-264 name=__codelineno-3-264 href=#__codelineno-3-264></a>            <span class=n>svm_key</span><span class=p>,</span>
</span><span id=__span-3-265><a id=__codelineno-3-265 name=__codelineno-3-265 href=#__codelineno-3-265></a>            <span class=n>mgmt_interface</span><span class=p>,</span>
</span><span id=__span-3-266><a id=__codelineno-3-266 name=__codelineno-3-266 href=#__codelineno-3-266></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-3-267><a id=__codelineno-3-267 name=__codelineno-3-267 href=#__codelineno-3-267></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-3-268><a id=__codelineno-3-268 name=__codelineno-3-268 href=#__codelineno-3-268></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-3-269><a id=__codelineno-3-269 name=__codelineno-3-269 href=#__codelineno-3-269></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-3-270><a id=__codelineno-3-270 name=__codelineno-3-270 href=#__codelineno-3-270></a>        <span class=p>)</span>
</span><span id=__span-3-271><a id=__codelineno-3-271 name=__codelineno-3-271 href=#__codelineno-3-271></a>
</span><span id=__span-3-272><a id=__codelineno-3-272 name=__codelineno-3-272 href=#__codelineno-3-272></a>        <span class=c1># Create data interface</span>
</span><span id=__span-3-273><a id=__codelineno-3-273 name=__codelineno-3-273 href=#__codelineno-3-273></a>        <span class=n>data_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-3-274><a id=__codelineno-3-274 name=__codelineno-3-274 href=#__codelineno-3-274></a>            <span class=n>create_network_interface</span><span class=p>,</span>
</span><span id=__span-3-275><a id=__codelineno-3-275 name=__codelineno-3-275 href=#__codelineno-3-275></a>            <span class=n>svm_key</span><span class=p>,</span>
</span><span id=__span-3-276><a id=__codelineno-3-276 name=__codelineno-3-276 href=#__codelineno-3-276></a>            <span class=n>data_interface</span><span class=p>,</span>
</span><span id=__span-3-277><a id=__codelineno-3-277 name=__codelineno-3-277 href=#__codelineno-3-277></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-3-278><a id=__codelineno-3-278 name=__codelineno-3-278 href=#__codelineno-3-278></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-3-279><a id=__codelineno-3-279 name=__codelineno-3-279 href=#__codelineno-3-279></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-3-280><a id=__codelineno-3-280 name=__codelineno-3-280 href=#__codelineno-3-280></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-3-281><a id=__codelineno-3-281 name=__codelineno-3-281 href=#__codelineno-3-281></a>        <span class=p>)</span>
</span><span id=__span-3-282><a id=__codelineno-3-282 name=__codelineno-3-282 href=#__codelineno-3-282></a>
</span><span id=__span-3-283><a id=__codelineno-3-283 name=__codelineno-3-283 href=#__codelineno-3-283></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-3-284><a id=__codelineno-3-284 name=__codelineno-3-284 href=#__codelineno-3-284></a>            <span class=s2>&quot;svm_name&quot;</span><span class=p>:</span> <span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-3-285><a id=__codelineno-3-285 name=__codelineno-3-285 href=#__codelineno-3-285></a>            <span class=s2>&quot;svm_key&quot;</span><span class=p>:</span> <span class=n>svm_key</span><span class=p>,</span>
</span><span id=__span-3-286><a id=__codelineno-3-286 name=__codelineno-3-286 href=#__codelineno-3-286></a>            <span class=s2>&quot;cluster_info&quot;</span><span class=p>:</span> <span class=n>cluster_info</span><span class=p>,</span>
</span><span id=__span-3-287><a id=__codelineno-3-287 name=__codelineno-3-287 href=#__codelineno-3-287></a>            <span class=s2>&quot;aggregate_used&quot;</span><span class=p>:</span> <span class=n>best_aggregate</span> <span class=k>if</span> <span class=n>aggregates</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-3-288><a id=__codelineno-3-288 name=__codelineno-3-288 href=#__codelineno-3-288></a>            <span class=s2>&quot;management_interface&quot;</span><span class=p>:</span> <span class=n>mgmt_result</span><span class=p>,</span>
</span><span id=__span-3-289><a id=__codelineno-3-289 name=__codelineno-3-289 href=#__codelineno-3-289></a>            <span class=s2>&quot;data_interface&quot;</span><span class=p>:</span> <span class=n>data_result</span><span class=p>,</span>
</span><span id=__span-3-290><a id=__codelineno-3-290 name=__codelineno-3-290 href=#__codelineno-3-290></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;completed&quot;</span>
</span><span id=__span-3-291><a id=__codelineno-3-291 name=__codelineno-3-291 href=#__codelineno-3-291></a>        <span class=p>}</span>
</span></code></pre></div> <h3 id=2-nfs-share-creation-workflow>2. NFS Share Creation Workflow<a class=headerlink href=#2-nfs-share-creation-workflow title="Permanent link">&para;</a></h3> <p>Based on the NFS Share Creation Sequence Diagram:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nd>@dataclass</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>class</span><span class=w> </span><span class=nc>NFSShareConfig</span><span class=p>:</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>svm_key</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>    <span class=n>size</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=n>export_policy_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;default&quot;</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=n>unix_permissions</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;755&quot;</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>    <span class=n>security_style</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unix&quot;</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=nd>@dataclass</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=k>class</span><span class=w> </span><span class=nc>ExportPolicyRule</span><span class=p>:</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>    <span class=n>clients</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>    <span class=n>protocols</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>    <span class=n>ro_rule</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>    <span class=n>rw_rule</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=n>superuser</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>    <span class=n>allow_suid</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=c1># NFS-specific Activities</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_export_policy</span><span class=p>(</span><span class=n>svm_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>policy_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>rules</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ExportPolicyRule</span><span class=p>],</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 1: Create export policy with rules&quot;&quot;&quot;</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/datacenter/svm/svms/</span><span class=si>{</span><span class=n>svm_key</span><span class=si>}</span><span class=s2>/export-policies&quot;</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>policy_name</span><span class=p>,</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>        <span class=s2>&quot;rules&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>            <span class=p>{</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>                <span class=s2>&quot;clients&quot;</span><span class=p>:</span> <span class=n>rule</span><span class=o>.</span><span class=n>clients</span><span class=p>,</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>                <span class=s2>&quot;protocols&quot;</span><span class=p>:</span> <span class=n>rule</span><span class=o>.</span><span class=n>protocols</span><span class=p>,</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>                <span class=s2>&quot;ro_rule&quot;</span><span class=p>:</span> <span class=n>rule</span><span class=o>.</span><span class=n>ro_rule</span><span class=p>,</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>                <span class=s2>&quot;rw_rule&quot;</span><span class=p>:</span> <span class=n>rule</span><span class=o>.</span><span class=n>rw_rule</span><span class=p>,</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>                <span class=s2>&quot;superuser&quot;</span><span class=p>:</span> <span class=n>rule</span><span class=o>.</span><span class=n>superuser</span><span class=p>,</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>                <span class=s2>&quot;allow_suid&quot;</span><span class=p>:</span> <span class=n>rule</span><span class=o>.</span><span class=n>allow_suid</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>            <span class=p>}</span> <span class=k>for</span> <span class=n>rule</span> <span class=ow>in</span> <span class=n>rules</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>        <span class=p>]</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>    <span class=p>}</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>201</span><span class=p>,</span> <span class=mi>202</span><span class=p>]:</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to create export policy: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;‚úì Export policy </span><span class=si>{</span><span class=n>policy_name</span><span class=si>}</span><span class=s2> created&quot;</span><span class=p>)</span>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-4-47><a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>
</span><span id=__span-4-48><a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-4-49><a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_file_share</span><span class=p>(</span><span class=n>share_config</span><span class=p>:</span> <span class=n>NFSShareConfig</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-4-50><a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 2: Create NFS file share&quot;&quot;&quot;</span>
</span><span id=__span-4-51><a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/storage-provider/file-shares&quot;</span>
</span><span id=__span-4-52><a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a>
</span><span id=__span-4-53><a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-4-54><a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-4-55><a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a>        <span class=s2>&quot;size&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-4-56><a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a>        <span class=s2>&quot;svm&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>svm_key</span><span class=p>},</span>
</span><span id=__span-4-57><a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a>        <span class=s2>&quot;path&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
</span><span id=__span-4-58><a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a>        <span class=s2>&quot;export_policy&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>export_policy_name</span><span class=p>},</span>
</span><span id=__span-4-59><a id=__codelineno-4-59 name=__codelineno-4-59 href=#__codelineno-4-59></a>        <span class=s2>&quot;unix_permissions&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>unix_permissions</span><span class=p>,</span>
</span><span id=__span-4-60><a id=__codelineno-4-60 name=__codelineno-4-60 href=#__codelineno-4-60></a>        <span class=s2>&quot;security_style&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>security_style</span>
</span><span id=__span-4-61><a id=__codelineno-4-61 name=__codelineno-4-61 href=#__codelineno-4-61></a>    <span class=p>}</span>
</span><span id=__span-4-62><a id=__codelineno-4-62 name=__codelineno-4-62 href=#__codelineno-4-62></a>
</span><span id=__span-4-63><a id=__codelineno-4-63 name=__codelineno-4-63 href=#__codelineno-4-63></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span><span id=__span-4-64><a id=__codelineno-4-64 name=__codelineno-4-64 href=#__codelineno-4-64></a>
</span><span id=__span-4-65><a id=__codelineno-4-65 name=__codelineno-4-65 href=#__codelineno-4-65></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>201</span><span class=p>,</span> <span class=mi>202</span><span class=p>]:</span>
</span><span id=__span-4-66><a id=__codelineno-4-66 name=__codelineno-4-66 href=#__codelineno-4-66></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to create file share: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-67><a id=__codelineno-4-67 name=__codelineno-4-67 href=#__codelineno-4-67></a>
</span><span id=__span-4-68><a id=__codelineno-4-68 name=__codelineno-4-68 href=#__codelineno-4-68></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;‚úì NFS share </span><span class=si>{</span><span class=n>share_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> created&quot;</span><span class=p>)</span>
</span><span id=__span-4-69><a id=__codelineno-4-69 name=__codelineno-4-69 href=#__codelineno-4-69></a>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-4-70><a id=__codelineno-4-70 name=__codelineno-4-70 href=#__codelineno-4-70></a>
</span><span id=__span-4-71><a id=__codelineno-4-71 name=__codelineno-4-71 href=#__codelineno-4-71></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-4-72><a id=__codelineno-4-72 name=__codelineno-4-72 href=#__codelineno-4-72></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>apply_export_policy</span><span class=p>(</span><span class=n>share_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>policy_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-4-73><a id=__codelineno-4-73 name=__codelineno-4-73 href=#__codelineno-4-73></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 3: Apply export policy to file share&quot;&quot;&quot;</span>
</span><span id=__span-4-74><a id=__codelineno-4-74 name=__codelineno-4-74 href=#__codelineno-4-74></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/storage-provider/file-shares/</span><span class=si>{</span><span class=n>share_key</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-4-75><a id=__codelineno-4-75 name=__codelineno-4-75 href=#__codelineno-4-75></a>
</span><span id=__span-4-76><a id=__codelineno-4-76 name=__codelineno-4-76 href=#__codelineno-4-76></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-4-77><a id=__codelineno-4-77 name=__codelineno-4-77 href=#__codelineno-4-77></a>        <span class=s2>&quot;export_policy&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>policy_name</span><span class=p>}</span>
</span><span id=__span-4-78><a id=__codelineno-4-78 name=__codelineno-4-78 href=#__codelineno-4-78></a>    <span class=p>}</span>
</span><span id=__span-4-79><a id=__codelineno-4-79 name=__codelineno-4-79 href=#__codelineno-4-79></a>
</span><span id=__span-4-80><a id=__codelineno-4-80 name=__codelineno-4-80 href=#__codelineno-4-80></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>patch</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-4-81><a id=__codelineno-4-81 name=__codelineno-4-81 href=#__codelineno-4-81></a>
</span><span id=__span-4-82><a id=__codelineno-4-82 name=__codelineno-4-82 href=#__codelineno-4-82></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-4-83><a id=__codelineno-4-83 name=__codelineno-4-83 href=#__codelineno-4-83></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to apply export policy: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-84><a id=__codelineno-4-84 name=__codelineno-4-84 href=#__codelineno-4-84></a>
</span><span id=__span-4-85><a id=__codelineno-4-85 name=__codelineno-4-85 href=#__codelineno-4-85></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;‚úì Export policy </span><span class=si>{</span><span class=n>policy_name</span><span class=si>}</span><span class=s2> applied to share&quot;</span><span class=p>)</span>
</span><span id=__span-4-86><a id=__codelineno-4-86 name=__codelineno-4-86 href=#__codelineno-4-86></a>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-4-87><a id=__codelineno-4-87 name=__codelineno-4-87 href=#__codelineno-4-87></a>
</span><span id=__span-4-88><a id=__codelineno-4-88 name=__codelineno-4-88 href=#__codelineno-4-88></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-4-89><a id=__codelineno-4-89 name=__codelineno-4-89 href=#__codelineno-4-89></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>verify_nfs_access</span><span class=p>(</span><span class=n>svm_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-4-90><a id=__codelineno-4-90 name=__codelineno-4-90 href=#__codelineno-4-90></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Step 4: Verify NFS service is accessible&quot;&quot;&quot;</span>
</span><span id=__span-4-91><a id=__codelineno-4-91 name=__codelineno-4-91 href=#__codelineno-4-91></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://</span><span class=si>{</span><span class=n>um_host</span><span class=si>}</span><span class=s2>/api/v2/datacenter/svm/svms/</span><span class=si>{</span><span class=n>svm_key</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-4-92><a id=__codelineno-4-92 name=__codelineno-4-92 href=#__codelineno-4-92></a>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;fields&quot;</span><span class=p>:</span> <span class=s2>&quot;nfs.enabled,state,protocols&quot;</span><span class=p>}</span>
</span><span id=__span-4-93><a id=__codelineno-4-93 name=__codelineno-4-93 href=#__codelineno-4-93></a>
</span><span id=__span-4-94><a id=__codelineno-4-94 name=__codelineno-4-94 href=#__codelineno-4-94></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=o>*</span><span class=n>auth</span><span class=p>),</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-4-95><a id=__codelineno-4-95 name=__codelineno-4-95 href=#__codelineno-4-95></a>
</span><span id=__span-4-96><a id=__codelineno-4-96 name=__codelineno-4-96 href=#__codelineno-4-96></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-4-97><a id=__codelineno-4-97 name=__codelineno-4-97 href=#__codelineno-4-97></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to verify NFS access: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-98><a id=__codelineno-4-98 name=__codelineno-4-98 href=#__codelineno-4-98></a>
</span><span id=__span-4-99><a id=__codelineno-4-99 name=__codelineno-4-99 href=#__codelineno-4-99></a>    <span class=n>svm_info</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-4-100><a id=__codelineno-4-100 name=__codelineno-4-100 href=#__codelineno-4-100></a>
</span><span id=__span-4-101><a id=__codelineno-4-101 name=__codelineno-4-101 href=#__codelineno-4-101></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>svm_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;nfs&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;enabled&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-4-102><a id=__codelineno-4-102 name=__codelineno-4-102 href=#__codelineno-4-102></a>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&quot;NFS is not enabled on SVM&quot;</span><span class=p>)</span>
</span><span id=__span-4-103><a id=__codelineno-4-103 name=__codelineno-4-103 href=#__codelineno-4-103></a>
</span><span id=__span-4-104><a id=__codelineno-4-104 name=__codelineno-4-104 href=#__codelineno-4-104></a>    <span class=n>activity</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;‚úì NFS access verified&quot;</span><span class=p>)</span>
</span><span id=__span-4-105><a id=__codelineno-4-105 name=__codelineno-4-105 href=#__codelineno-4-105></a>    <span class=k>return</span> <span class=n>svm_info</span>
</span><span id=__span-4-106><a id=__codelineno-4-106 name=__codelineno-4-106 href=#__codelineno-4-106></a>
</span><span id=__span-4-107><a id=__codelineno-4-107 name=__codelineno-4-107 href=#__codelineno-4-107></a><span class=c1># NFS Share Creation Workflow</span>
</span><span id=__span-4-108><a id=__codelineno-4-108 name=__codelineno-4-108 href=#__codelineno-4-108></a><span class=nd>@workflow</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-4-109><a id=__codelineno-4-109 name=__codelineno-4-109 href=#__codelineno-4-109></a><span class=k>class</span><span class=w> </span><span class=nc>NFSShareCreationWorkflow</span><span class=p>:</span>
</span><span id=__span-4-110><a id=__codelineno-4-110 name=__codelineno-4-110 href=#__codelineno-4-110></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Complete NFS Share Creation Workflow based on sequence diagram&quot;&quot;&quot;</span>
</span><span id=__span-4-111><a id=__codelineno-4-111 name=__codelineno-4-111 href=#__codelineno-4-111></a>
</span><span id=__span-4-112><a id=__codelineno-4-112 name=__codelineno-4-112 href=#__codelineno-4-112></a>    <span class=nd>@workflow</span><span class=o>.</span><span class=n>run</span>
</span><span id=__span-4-113><a id=__codelineno-4-113 name=__codelineno-4-113 href=#__codelineno-4-113></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>share_config</span><span class=p>:</span> <span class=n>NFSShareConfig</span><span class=p>,</span> <span class=n>export_rules</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ExportPolicyRule</span><span class=p>],</span> <span class=n>um_host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>auth</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-4-114><a id=__codelineno-4-114 name=__codelineno-4-114 href=#__codelineno-4-114></a>        <span class=n>retry_policy</span> <span class=o>=</span> <span class=n>RetryPolicy</span><span class=p>(</span>
</span><span id=__span-4-115><a id=__codelineno-4-115 name=__codelineno-4-115 href=#__codelineno-4-115></a>            <span class=n>initial_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-4-116><a id=__codelineno-4-116 name=__codelineno-4-116 href=#__codelineno-4-116></a>            <span class=n>maximum_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-4-117><a id=__codelineno-4-117 name=__codelineno-4-117 href=#__codelineno-4-117></a>            <span class=n>maximum_attempts</span><span class=o>=</span><span class=mi>3</span>
</span><span id=__span-4-118><a id=__codelineno-4-118 name=__codelineno-4-118 href=#__codelineno-4-118></a>        <span class=p>)</span>
</span><span id=__span-4-119><a id=__codelineno-4-119 name=__codelineno-4-119 href=#__codelineno-4-119></a>
</span><span id=__span-4-120><a id=__codelineno-4-120 name=__codelineno-4-120 href=#__codelineno-4-120></a>        <span class=n>workflow</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Starting NFS share creation workflow for </span><span class=si>{</span><span class=n>share_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-121><a id=__codelineno-4-121 name=__codelineno-4-121 href=#__codelineno-4-121></a>
</span><span id=__span-4-122><a id=__codelineno-4-122 name=__codelineno-4-122 href=#__codelineno-4-122></a>        <span class=c1># Step 1: Create export policy</span>
</span><span id=__span-4-123><a id=__codelineno-4-123 name=__codelineno-4-123 href=#__codelineno-4-123></a>        <span class=n>export_policy_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-4-124><a id=__codelineno-4-124 name=__codelineno-4-124 href=#__codelineno-4-124></a>            <span class=n>create_export_policy</span><span class=p>,</span>
</span><span id=__span-4-125><a id=__codelineno-4-125 name=__codelineno-4-125 href=#__codelineno-4-125></a>            <span class=n>share_config</span><span class=o>.</span><span class=n>svm_key</span><span class=p>,</span>
</span><span id=__span-4-126><a id=__codelineno-4-126 name=__codelineno-4-126 href=#__codelineno-4-126></a>            <span class=n>share_config</span><span class=o>.</span><span class=n>export_policy_name</span><span class=p>,</span>
</span><span id=__span-4-127><a id=__codelineno-4-127 name=__codelineno-4-127 href=#__codelineno-4-127></a>            <span class=n>export_rules</span><span class=p>,</span>
</span><span id=__span-4-128><a id=__codelineno-4-128 name=__codelineno-4-128 href=#__codelineno-4-128></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-4-129><a id=__codelineno-4-129 name=__codelineno-4-129 href=#__codelineno-4-129></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-4-130><a id=__codelineno-4-130 name=__codelineno-4-130 href=#__codelineno-4-130></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-4-131><a id=__codelineno-4-131 name=__codelineno-4-131 href=#__codelineno-4-131></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-4-132><a id=__codelineno-4-132 name=__codelineno-4-132 href=#__codelineno-4-132></a>        <span class=p>)</span>
</span><span id=__span-4-133><a id=__codelineno-4-133 name=__codelineno-4-133 href=#__codelineno-4-133></a>
</span><span id=__span-4-134><a id=__codelineno-4-134 name=__codelineno-4-134 href=#__codelineno-4-134></a>        <span class=c1># Step 2: Create file share</span>
</span><span id=__span-4-135><a id=__codelineno-4-135 name=__codelineno-4-135 href=#__codelineno-4-135></a>        <span class=n>share_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-4-136><a id=__codelineno-4-136 name=__codelineno-4-136 href=#__codelineno-4-136></a>            <span class=n>create_file_share</span><span class=p>,</span>
</span><span id=__span-4-137><a id=__codelineno-4-137 name=__codelineno-4-137 href=#__codelineno-4-137></a>            <span class=n>share_config</span><span class=p>,</span>
</span><span id=__span-4-138><a id=__codelineno-4-138 name=__codelineno-4-138 href=#__codelineno-4-138></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-4-139><a id=__codelineno-4-139 name=__codelineno-4-139 href=#__codelineno-4-139></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-4-140><a id=__codelineno-4-140 name=__codelineno-4-140 href=#__codelineno-4-140></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>5</span><span class=p>),</span>
</span><span id=__span-4-141><a id=__codelineno-4-141 name=__codelineno-4-141 href=#__codelineno-4-141></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-4-142><a id=__codelineno-4-142 name=__codelineno-4-142 href=#__codelineno-4-142></a>        <span class=p>)</span>
</span><span id=__span-4-143><a id=__codelineno-4-143 name=__codelineno-4-143 href=#__codelineno-4-143></a>
</span><span id=__span-4-144><a id=__codelineno-4-144 name=__codelineno-4-144 href=#__codelineno-4-144></a>        <span class=n>share_key</span> <span class=o>=</span> <span class=n>share_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span>
</span><span id=__span-4-145><a id=__codelineno-4-145 name=__codelineno-4-145 href=#__codelineno-4-145></a>
</span><span id=__span-4-146><a id=__codelineno-4-146 name=__codelineno-4-146 href=#__codelineno-4-146></a>        <span class=c1># Step 3: Apply export policy (if not already applied)</span>
</span><span id=__span-4-147><a id=__codelineno-4-147 name=__codelineno-4-147 href=#__codelineno-4-147></a>        <span class=k>if</span> <span class=n>share_key</span><span class=p>:</span>
</span><span id=__span-4-148><a id=__codelineno-4-148 name=__codelineno-4-148 href=#__codelineno-4-148></a>            <span class=n>policy_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-4-149><a id=__codelineno-4-149 name=__codelineno-4-149 href=#__codelineno-4-149></a>                <span class=n>apply_export_policy</span><span class=p>,</span>
</span><span id=__span-4-150><a id=__codelineno-4-150 name=__codelineno-4-150 href=#__codelineno-4-150></a>                <span class=n>share_key</span><span class=p>,</span>
</span><span id=__span-4-151><a id=__codelineno-4-151 name=__codelineno-4-151 href=#__codelineno-4-151></a>                <span class=n>share_config</span><span class=o>.</span><span class=n>export_policy_name</span><span class=p>,</span>
</span><span id=__span-4-152><a id=__codelineno-4-152 name=__codelineno-4-152 href=#__codelineno-4-152></a>                <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-4-153><a id=__codelineno-4-153 name=__codelineno-4-153 href=#__codelineno-4-153></a>                <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-4-154><a id=__codelineno-4-154 name=__codelineno-4-154 href=#__codelineno-4-154></a>                <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-4-155><a id=__codelineno-4-155 name=__codelineno-4-155 href=#__codelineno-4-155></a>                <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-4-156><a id=__codelineno-4-156 name=__codelineno-4-156 href=#__codelineno-4-156></a>            <span class=p>)</span>
</span><span id=__span-4-157><a id=__codelineno-4-157 name=__codelineno-4-157 href=#__codelineno-4-157></a>
</span><span id=__span-4-158><a id=__codelineno-4-158 name=__codelineno-4-158 href=#__codelineno-4-158></a>        <span class=c1># Step 4: Verify NFS access</span>
</span><span id=__span-4-159><a id=__codelineno-4-159 name=__codelineno-4-159 href=#__codelineno-4-159></a>        <span class=n>nfs_verification</span> <span class=o>=</span> <span class=k>await</span> <span class=n>workflow</span><span class=o>.</span><span class=n>execute_activity</span><span class=p>(</span>
</span><span id=__span-4-160><a id=__codelineno-4-160 name=__codelineno-4-160 href=#__codelineno-4-160></a>            <span class=n>verify_nfs_access</span><span class=p>,</span>
</span><span id=__span-4-161><a id=__codelineno-4-161 name=__codelineno-4-161 href=#__codelineno-4-161></a>            <span class=n>share_config</span><span class=o>.</span><span class=n>svm_key</span><span class=p>,</span>
</span><span id=__span-4-162><a id=__codelineno-4-162 name=__codelineno-4-162 href=#__codelineno-4-162></a>            <span class=n>um_host</span><span class=p>,</span>
</span><span id=__span-4-163><a id=__codelineno-4-163 name=__codelineno-4-163 href=#__codelineno-4-163></a>            <span class=n>auth</span><span class=p>,</span>
</span><span id=__span-4-164><a id=__codelineno-4-164 name=__codelineno-4-164 href=#__codelineno-4-164></a>            <span class=n>start_to_close_timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-4-165><a id=__codelineno-4-165 name=__codelineno-4-165 href=#__codelineno-4-165></a>            <span class=n>retry_policy</span><span class=o>=</span><span class=n>retry_policy</span>
</span><span id=__span-4-166><a id=__codelineno-4-166 name=__codelineno-4-166 href=#__codelineno-4-166></a>        <span class=p>)</span>
</span><span id=__span-4-167><a id=__codelineno-4-167 name=__codelineno-4-167 href=#__codelineno-4-167></a>
</span><span id=__span-4-168><a id=__codelineno-4-168 name=__codelineno-4-168 href=#__codelineno-4-168></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-4-169><a id=__codelineno-4-169 name=__codelineno-4-169 href=#__codelineno-4-169></a>            <span class=s2>&quot;share_name&quot;</span><span class=p>:</span> <span class=n>share_config</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-4-170><a id=__codelineno-4-170 name=__codelineno-4-170 href=#__codelineno-4-170></a>            <span class=s2>&quot;share_key&quot;</span><span class=p>:</span> <span class=n>share_key</span><span class=p>,</span>
</span><span id=__span-4-171><a id=__codelineno-4-171 name=__codelineno-4-171 href=#__codelineno-4-171></a>            <span class=s2>&quot;export_policy&quot;</span><span class=p>:</span> <span class=n>export_policy_result</span><span class=p>,</span>
</span><span id=__span-4-172><a id=__codelineno-4-172 name=__codelineno-4-172 href=#__codelineno-4-172></a>            <span class=s2>&quot;nfs_verification&quot;</span><span class=p>:</span> <span class=n>nfs_verification</span><span class=p>,</span>
</span><span id=__span-4-173><a id=__codelineno-4-173 name=__codelineno-4-173 href=#__codelineno-4-173></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;completed&quot;</span>
</span><span id=__span-4-174><a id=__codelineno-4-174 name=__codelineno-4-174 href=#__codelineno-4-174></a>        <span class=p>}</span>
</span></code></pre></div> <h3 id=3-worker-implementation>3. Worker Implementation<a class=headerlink href=#3-worker-implementation title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># worker.py</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=kn>from</span><span class=w> </span><span class=nn>temporalio.client</span><span class=w> </span><span class=kn>import</span> <span class=n>Client</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=kn>from</span><span class=w> </span><span class=nn>temporalio.worker</span><span class=w> </span><span class=kn>import</span> <span class=n>Worker</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=kn>from</span><span class=w> </span><span class=nn>netapp_workflows</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=n>SVMCreationWorkflow</span><span class=p>,</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=n>NFSShareCreationWorkflow</span><span class=p>,</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=c1># Import all activities</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    <span class=n>validate_cluster_health</span><span class=p>,</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>    <span class=n>get_available_aggregates</span><span class=p>,</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=n>create_svm</span><span class=p>,</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>    <span class=n>monitor_job_completion</span><span class=p>,</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>    <span class=n>create_network_interface</span><span class=p>,</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>    <span class=n>create_export_policy</span><span class=p>,</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>    <span class=n>create_file_share</span><span class=p>,</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=n>apply_export_policy</span><span class=p>,</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>    <span class=n>verify_nfs_access</span><span class=p>,</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=p>)</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>main</span><span class=p>():</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>    <span class=c1># Connect to Temporal server</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>    <span class=n>client</span> <span class=o>=</span> <span class=k>await</span> <span class=n>Client</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;TEMPORAL_HOST&quot;</span><span class=p>,</span> <span class=s2>&quot;localhost:7233&quot;</span><span class=p>))</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>    <span class=c1># Create worker</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>    <span class=n>worker</span> <span class=o>=</span> <span class=n>Worker</span><span class=p>(</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>        <span class=n>client</span><span class=p>,</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>        <span class=n>task_queue</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;TASK_QUEUE&quot;</span><span class=p>,</span> <span class=s2>&quot;netapp-activeiq&quot;</span><span class=p>),</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>        <span class=n>workflows</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>            <span class=n>SVMCreationWorkflow</span><span class=p>,</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a>            <span class=n>NFSShareCreationWorkflow</span><span class=p>,</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>        <span class=p>],</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>        <span class=n>activities</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>            <span class=n>validate_cluster_health</span><span class=p>,</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>            <span class=n>get_available_aggregates</span><span class=p>,</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a>            <span class=n>create_svm</span><span class=p>,</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>            <span class=n>monitor_job_completion</span><span class=p>,</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>            <span class=n>create_network_interface</span><span class=p>,</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>            <span class=n>create_export_policy</span><span class=p>,</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>            <span class=n>create_file_share</span><span class=p>,</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a>            <span class=n>apply_export_policy</span><span class=p>,</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a>            <span class=n>verify_nfs_access</span><span class=p>,</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a>        <span class=p>],</span>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a>    <span class=p>)</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Starting NetApp ActiveIQ Temporal worker...&quot;</span><span class=p>)</span>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a>    <span class=k>await</span> <span class=n>worker</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></code></pre></div> <h3 id=4-client-usage-examples>4. Client Usage Examples<a class=headerlink href=#4-client-usage-examples title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># client.py</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=kn>from</span><span class=w> </span><span class=nn>temporalio.client</span><span class=w> </span><span class=kn>import</span> <span class=n>Client</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=kn>from</span><span class=w> </span><span class=nn>netapp_workflows</span><span class=w> </span><span class=kn>import</span> <span class=n>SVMConfig</span><span class=p>,</span> <span class=n>NFSShareConfig</span><span class=p>,</span> <span class=n>ExportPolicyRule</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run_svm_creation</span><span class=p>():</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    <span class=n>client</span> <span class=o>=</span> <span class=k>await</span> <span class=n>Client</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;TEMPORAL_HOST&quot;</span><span class=p>,</span> <span class=s2>&quot;localhost:7233&quot;</span><span class=p>))</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>    <span class=c1># Configure SVM</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>    <span class=n>svm_config</span> <span class=o>=</span> <span class=n>SVMConfig</span><span class=p>(</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;production_nfs_svm&quot;</span><span class=p>,</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>        <span class=n>cluster_key</span><span class=o>=</span><span class=s2>&quot;cluster-12345-abcde&quot;</span><span class=p>,</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>        <span class=n>protocols</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;nfs&quot;</span><span class=p>]</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>    <span class=p>)</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>    <span class=c1># Start workflow</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>execute_workflow</span><span class=p>(</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>        <span class=s2>&quot;SVMCreationWorkflow.run&quot;</span><span class=p>,</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>        <span class=n>svm_config</span><span class=p>,</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>        <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;NETAPP_UM_HOST&quot;</span><span class=p>),</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>        <span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;NETAPP_USERNAME&quot;</span><span class=p>),</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;NETAPP_PASSWORD&quot;</span><span class=p>)),</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>        <span class=nb>id</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;svm-creation-</span><span class=si>{</span><span class=n>svm_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>        <span class=n>task_queue</span><span class=o>=</span><span class=s2>&quot;netapp-activeiq&quot;</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>    <span class=p>)</span>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;SVM Creation Result: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a>
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run_nfs_share_creation</span><span class=p>(</span><span class=n>svm_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-6-32><a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a>    <span class=n>client</span> <span class=o>=</span> <span class=k>await</span> <span class=n>Client</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;TEMPORAL_HOST&quot;</span><span class=p>,</span> <span class=s2>&quot;localhost:7233&quot;</span><span class=p>))</span>
</span><span id=__span-6-33><a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>
</span><span id=__span-6-34><a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a>    <span class=c1># Configure NFS share</span>
</span><span id=__span-6-35><a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a>    <span class=n>share_config</span> <span class=o>=</span> <span class=n>NFSShareConfig</span><span class=p>(</span>
</span><span id=__span-6-36><a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;shared_documents&quot;</span><span class=p>,</span>
</span><span id=__span-6-37><a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a>        <span class=n>svm_key</span><span class=o>=</span><span class=n>svm_key</span><span class=p>,</span>
</span><span id=__span-6-38><a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a>        <span class=n>path</span><span class=o>=</span><span class=s2>&quot;/shared_documents&quot;</span><span class=p>,</span>
</span><span id=__span-6-39><a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a>        <span class=n>size</span><span class=o>=</span><span class=s2>&quot;500GB&quot;</span><span class=p>,</span>
</span><span id=__span-6-40><a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a>        <span class=n>export_policy_name</span><span class=o>=</span><span class=s2>&quot;production_policy&quot;</span>
</span><span id=__span-6-41><a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a>    <span class=p>)</span>
</span><span id=__span-6-42><a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a>
</span><span id=__span-6-43><a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a>    <span class=c1># Define export rules</span>
</span><span id=__span-6-44><a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a>    <span class=n>export_rules</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-6-45><a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>        <span class=n>ExportPolicyRule</span><span class=p>(</span>
</span><span id=__span-6-46><a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a>            <span class=n>clients</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;10.1.0.0/16&quot;</span><span class=p>],</span>
</span><span id=__span-6-47><a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a>            <span class=n>protocols</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;nfs3&quot;</span><span class=p>,</span> <span class=s2>&quot;nfs4&quot;</span><span class=p>],</span>
</span><span id=__span-6-48><a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a>            <span class=n>ro_rule</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;sys&quot;</span><span class=p>],</span>
</span><span id=__span-6-49><a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>            <span class=n>rw_rule</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;sys&quot;</span><span class=p>],</span>
</span><span id=__span-6-50><a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a>            <span class=n>superuser</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;sys&quot;</span><span class=p>]</span>
</span><span id=__span-6-51><a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a>        <span class=p>),</span>
</span><span id=__span-6-52><a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a>        <span class=n>ExportPolicyRule</span><span class=p>(</span>
</span><span id=__span-6-53><a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a>            <span class=n>clients</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;192.168.1.0/24&quot;</span><span class=p>],</span>
</span><span id=__span-6-54><a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a>            <span class=n>protocols</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;nfs3&quot;</span><span class=p>,</span> <span class=s2>&quot;nfs4&quot;</span><span class=p>],</span>
</span><span id=__span-6-55><a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a>            <span class=n>ro_rule</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;sys&quot;</span><span class=p>],</span>
</span><span id=__span-6-56><a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a>            <span class=n>rw_rule</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;none&quot;</span><span class=p>],</span>
</span><span id=__span-6-57><a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a>            <span class=n>superuser</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;none&quot;</span><span class=p>]</span>
</span><span id=__span-6-58><a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a>        <span class=p>)</span>
</span><span id=__span-6-59><a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a>    <span class=p>]</span>
</span><span id=__span-6-60><a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a>
</span><span id=__span-6-61><a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a>    <span class=c1># Start workflow</span>
</span><span id=__span-6-62><a id=__codelineno-6-62 name=__codelineno-6-62 href=#__codelineno-6-62></a>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>execute_workflow</span><span class=p>(</span>
</span><span id=__span-6-63><a id=__codelineno-6-63 name=__codelineno-6-63 href=#__codelineno-6-63></a>        <span class=s2>&quot;NFSShareCreationWorkflow.run&quot;</span><span class=p>,</span>
</span><span id=__span-6-64><a id=__codelineno-6-64 name=__codelineno-6-64 href=#__codelineno-6-64></a>        <span class=n>share_config</span><span class=p>,</span>
</span><span id=__span-6-65><a id=__codelineno-6-65 name=__codelineno-6-65 href=#__codelineno-6-65></a>        <span class=n>export_rules</span><span class=p>,</span>
</span><span id=__span-6-66><a id=__codelineno-6-66 name=__codelineno-6-66 href=#__codelineno-6-66></a>        <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;NETAPP_UM_HOST&quot;</span><span class=p>),</span>
</span><span id=__span-6-67><a id=__codelineno-6-67 name=__codelineno-6-67 href=#__codelineno-6-67></a>        <span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;NETAPP_USERNAME&quot;</span><span class=p>),</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;NETAPP_PASSWORD&quot;</span><span class=p>)),</span>
</span><span id=__span-6-68><a id=__codelineno-6-68 name=__codelineno-6-68 href=#__codelineno-6-68></a>        <span class=nb>id</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;nfs-share-</span><span class=si>{</span><span class=n>share_config</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-6-69><a id=__codelineno-6-69 name=__codelineno-6-69 href=#__codelineno-6-69></a>        <span class=n>task_queue</span><span class=o>=</span><span class=s2>&quot;netapp-activeiq&quot;</span>
</span><span id=__span-6-70><a id=__codelineno-6-70 name=__codelineno-6-70 href=#__codelineno-6-70></a>    <span class=p>)</span>
</span><span id=__span-6-71><a id=__codelineno-6-71 name=__codelineno-6-71 href=#__codelineno-6-71></a>
</span><span id=__span-6-72><a id=__codelineno-6-72 name=__codelineno-6-72 href=#__codelineno-6-72></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;NFS Share Creation Result: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-6-73><a id=__codelineno-6-73 name=__codelineno-6-73 href=#__codelineno-6-73></a>    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-6-74><a id=__codelineno-6-74 name=__codelineno-6-74 href=#__codelineno-6-74></a>
</span><span id=__span-6-75><a id=__codelineno-6-75 name=__codelineno-6-75 href=#__codelineno-6-75></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-6-76><a id=__codelineno-6-76 name=__codelineno-6-76 href=#__codelineno-6-76></a>    <span class=c1># Example: Create SVM first, then NFS share</span>
</span><span id=__span-6-77><a id=__codelineno-6-77 name=__codelineno-6-77 href=#__codelineno-6-77></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>main</span><span class=p>():</span>
</span><span id=__span-6-78><a id=__codelineno-6-78 name=__codelineno-6-78 href=#__codelineno-6-78></a>        <span class=n>svm_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>run_svm_creation</span><span class=p>()</span>
</span><span id=__span-6-79><a id=__codelineno-6-79 name=__codelineno-6-79 href=#__codelineno-6-79></a>        <span class=k>if</span> <span class=n>svm_result</span> <span class=ow>and</span> <span class=n>svm_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&quot;completed&quot;</span><span class=p>:</span>
</span><span id=__span-6-80><a id=__codelineno-6-80 name=__codelineno-6-80 href=#__codelineno-6-80></a>            <span class=k>await</span> <span class=n>run_nfs_share_creation</span><span class=p>(</span><span class=n>svm_result</span><span class=p>[</span><span class=s2>&quot;svm_key&quot;</span><span class=p>])</span>
</span><span id=__span-6-81><a id=__codelineno-6-81 name=__codelineno-6-81 href=#__codelineno-6-81></a>
</span><span id=__span-6-82><a id=__codelineno-6-82 name=__codelineno-6-82 href=#__codelineno-6-82></a>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></code></pre></div> <h2 id=running-the-workflows>Running the Workflows<a class=headerlink href=#running-the-workflows title="Permanent link">&para;</a></h2> <h3 id=1-start-temporal-server>1. Start Temporal Server<a class=headerlink href=#1-start-temporal-server title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>temporalio<span class=w> </span>-p<span class=w> </span><span class=m>7233</span>:7233<span class=w> </span>-p<span class=w> </span><span class=m>8080</span>:8080<span class=w> </span>temporalio/auto-setup
</span></code></pre></div> <h3 id=2-start-the-worker>2. Start the Worker<a class=headerlink href=#2-start-the-worker title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Set environment variables</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nb>export</span><span class=w> </span><span class=nv>NETAPP_UM_HOST</span><span class=o>=</span>your-unified-manager.company.com
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=nb>export</span><span class=w> </span><span class=nv>NETAPP_USERNAME</span><span class=o>=</span>admin
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=nb>export</span><span class=w> </span><span class=nv>NETAPP_PASSWORD</span><span class=o>=</span>your-password
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=c1># Start worker</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>python<span class=w> </span>worker.py
</span></code></pre></div> <h3 id=3-execute-workflows>3. Execute Workflows<a class=headerlink href=#3-execute-workflows title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># In another terminal</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>python<span class=w> </span>client.py
</span></code></pre></div> <h3 id=4-monitor-workflows>4. Monitor Workflows<a class=headerlink href=#4-monitor-workflows title="Permanent link">&para;</a></h3> <p>Access the Temporal Web UI at <code>http://localhost:8080</code> to monitor workflow execution, view logs, and debug issues.</p> <h2 id=error-handling-and-best-practices>Error Handling and Best Practices<a class=headerlink href=#error-handling-and-best-practices title="Permanent link">&para;</a></h2> <h3 id=retry-policies>Retry Policies<a class=headerlink href=#retry-policies title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Custom retry policy for critical operations</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>critical_retry_policy</span> <span class=o>=</span> <span class=n>RetryPolicy</span><span class=p>(</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>initial_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>maximum_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>5</span><span class=p>),</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=n>maximum_attempts</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>    <span class=n>backoff_coefficient</span><span class=o>=</span><span class=mf>2.0</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=p>)</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=c1># Non-critical operations</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=n>standard_retry_policy</span> <span class=o>=</span> <span class=n>RetryPolicy</span><span class=p>(</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    <span class=n>initial_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    <span class=n>maximum_interval</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=n>maximum_attempts</span><span class=o>=</span><span class=mi>3</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=p>)</span>
</span></code></pre></div> <h3 id=logging-and-monitoring>Logging and Monitoring<a class=headerlink href=#logging-and-monitoring title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Add structured logging</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=kn>import</span><span class=w> </span><span class=nn>structlog</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=n>logger</span> <span class=o>=</span> <span class=n>structlog</span><span class=o>.</span><span class=n>get_logger</span><span class=p>()</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=nd>@activity</span><span class=o>.</span><span class=n>defn</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>monitored_activity</span><span class=p>(</span><span class=n>param</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Activity started&quot;</span><span class=p>,</span> <span class=n>activity</span><span class=o>=</span><span class=s2>&quot;monitored_activity&quot;</span><span class=p>,</span> <span class=n>param</span><span class=o>=</span><span class=n>param</span><span class=p>)</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>        <span class=c1># Activity logic here</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>        <span class=n>result</span> <span class=o>=</span> <span class=s2>&quot;success&quot;</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Activity completed&quot;</span><span class=p>,</span> <span class=n>result</span><span class=o>=</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Activity failed&quot;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>param</span><span class=o>=</span><span class=n>param</span><span class=p>)</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>        <span class=k>raise</span>
</span></code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>This comprehensive Temporal.io integration provides:</p> <ul> <li><strong>Robust workflow execution</strong> for complex NetApp operations</li> <li><strong>Automatic error handling</strong> and retry mechanisms</li> <li><strong>Complete observability</strong> through the Temporal Web UI</li> <li><strong>Scalable architecture</strong> for handling multiple concurrent operations</li> <li><strong>Production-ready implementations</strong> based on real sequence diagrams</li> </ul> <p>The workflows can be extended to handle additional NetApp operations like credential updates, performance monitoring, and event processing as defined in the advanced use cases documentation.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 30, 2025 05:48:14 UTC">June 30, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 28, 2025 14:54:31 UTC">June 28, 2025</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/brunseba/lab-netapp-activeiq/issues/new/?title=[Feedback]+%F0%9F%94%84%20Workflow%20Integration+-+/temporal-integration/" target=_blank rel=noopener>telling us what you found helpful or what could be improved</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../DEVELOPMENT/ class="md-footer__link md-footer__link--prev" aria-label="Previous: ‚öôÔ∏è Development Setup"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> ‚öôÔ∏è Development Setup </div> </div> </a> <a href=../DEVELOPMENT/ class="md-footer__link md-footer__link--next" aria-label="Next: ‚öôÔ∏è Development Setup"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> ‚öôÔ∏è Development Setup </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 - Lab NetApp ActiveIQ </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/brunseba/lab-netapp-activeiq target=_blank rel=noopener title="GitHub Repository" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://github.com/brunseba/lab-netapp-activeiq/releases target=_blank rel=noopener title=Releases class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://github.com/brunseba/lab-netapp-activeiq/blob/main/idp_workload_estimator_embedded.py target=_blank rel=noopener title="IDP Workload Estimator Tool" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 0C28.7 0 0 28.7 0 64v384c0 35.3 28.7 64 64 64h256c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64zm32 64h192c17.7 0 32 14.3 32 32v32c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32m32 160a32 32 0 1 1-64 0 32 32 0 1 1 64 0M96 352a32 32 0 1 1 0-64 32 32 0 1 1 0 64m-32 64c0-17.7 14.3-32 32-32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H96c-17.7 0-32-14.3-32-32m128-160a32 32 0 1 1 0-64 32 32 0 1 1 0 64m32 64a32 32 0 1 1-64 0 32 32 0 1 1 64 0m64-64a32 32 0 1 1 0-64 32 32 0 1 1 0 64m32 64a32 32 0 1 1-64 0 32 32 0 1 1 64 0m-32 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64"/></svg> </a> <a href=https://github.com/brunseba/lab-netapp-activeiq/blob/main/README.md target=_blank rel=noopener title=Documentation class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M32 32c17.7 0 32 14.3 32 32v336c0 8.8 7.2 16 16 16h400c17.7 0 32 14.3 32 32s-14.3 32-32 32H80c-44.2 0-80-35.8-80-80V64c0-17.7 14.3-32 32-32m96 96c0-17.7 14.3-32 32-32h192c17.7 0 32 14.3 32 32s-14.3 32-32 32H160c-17.7 0-32-14.3-32-32m32 64h128c17.7 0 32 14.3 32 32s-14.3 32-32 32H160c-17.7 0-32-14.3-32-32s14.3-32 32-32m0 96h256c17.7 0 32 14.3 32 32s-14.3 32-32 32H160c-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"ActiveIQ": "activeiq", "Analysis": "analysis", "CLI": "cli", "DevOps": "devops", "Estimation": "estimation", "Excel": "excel", "IDP": "idp", "Lab": "lab", "NetApp": "netapp", "Planning": "planning", "Python": "python", "Reporting": "reporting", "Tool": "tool", "Workload": "workload"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../assets/javascripts/bundle.56ea9cef.min.js></script> </body> </html>